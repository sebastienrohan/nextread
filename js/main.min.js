!function(i){function t(t){var o=parseInt(i(t).attr("id"));i(t).fadeOut(function(){i("li").each(function(i){if(i>o){var t=i;t--,this.id=t}}),i(t).remove(),r--,localStorage.setItem("count",r)});var a=String(o);delete n[a],i.each(n,function(i,t){if(i>o){var a=parseInt(i);a--,n[a]=n[i],delete n[i]}});var e=JSON.stringify(n);localStorage.setItem("booklist",e),localStorage.setItem("count",r)}i("#search").focus();var o=localStorage.getItem("booklist"),n=JSON.parse(o);if(null!=n){var r=localStorage.getItem("count"),e="";for(var l in n){void 0==n[l].link&&(n[l].link=""),void 0==n[l].icon&&(n[l].icon=""),void 0==n[l].a&&(n[l].a="");var c="<li id='"+l+"'>"+n[l].title+n[l].link+"<div class='pull-right'>"+n[l].rating+" % "+n[l].icon+"</div>"+n[l].a+"</li>";e+=c}i("#list").html(e)}else var r=-1,n={};i.fn.textOnly=function(){return this.clone().children().remove().end().text()},i("ul").sortable({cursor:"move",stop:function(t,o){var a=i("li").length;i("li").each(function(t){var o=this;book_title=i(o).textOnly(),book_rating=parseInt(i(o).children().text()),isNaN(book_rating)&&(book_rating="?"),void 0==i("a",o).attr("href")?(book_link="",book_a=""):(book_link=i("a",o).attr("href"),book_link="<a href='"+book_link+"' target='_blank'>",book_a="</a>"),void 0==i("img",o).attr("src")?book_icon="":(book_icon=i("img",o).attr("src"),book_icon="<img src='"+book_icon+"'>"),a>t&&(this.id=t,n[t].title=book_title,n[t].rating=book_rating,n[t].link=book_link,n[t].icon=book_icon,n[t].a=book_a)});var r=JSON.stringify(n);localStorage.setItem("booklist",r)}}),i(function(){function t(){function t(i){for(var t=i.split(" "),o=[],a=0;a<t.length;a++){var n=t[a].charAt(0).toUpperCase();o.push(n+t[a].slice(1))}return i=o.join(" ")}function o(t,o,e){e=void 0==e?" ":"<img src='"+e+"'>",void 0==t?(t="",a=""):(t="<a href='"+t+"' target='_blank'>",a="</a>");var c=i("<li id='"+r+"'>"+l+t+"<div class='pull-right'>"+o+" % "+e+"</div>"+a+"</li>");l.length>40&&c.addClass("small"),c.hide(),i("#list").append(c),c.fadeIn(),i("#search").val("").focus(),localStorage.setItem("count",r);var s={};s.title=l,s.rating=o,s.link=t,s.a=a,s.icon=e,n[r]=s;var v=JSON.stringify(n);localStorage.setItem("booklist",v)}var e="6ad6214b9afeca197fbea7b1d6d52758b463689f",l=i("#search").val();return l=t(l),0==l.length?(i("#search").focus(),!1):(r++,void i.ajax({url:"http://idreambooks.com/api/books/reviews.json?q="+l+"&key="+e,dataType:"json",success:function(i){if(void 0!=i.book.rating)var t=i.book.to_read_or_not,a=i.book.detail_link,n=i.book.rating;else var n="?";o(a,n,t)},error:function(i){var t="?";o(link,t,icon)}}))}i("#search").keypress(function(i){13==i.which&&(t(),i.preventDefault())}),i("#add").click(function(){t()})}),i("#list").on("dblclick","li",function(){var i=this;t(i)}),i("#list").on("doubletap","li",function(){var i=this;t(i)}),i("#sort").click(function(){function t(i){for(var t={},o=0;o<i.length;++o)t[o]=i[o];return t}var o=[];for(var a in n)o.push(n[a]);o.sort(function(i,t){return"?"==i.rating&&(i.rating=0),"?"==t.rating&&(t.rating=0),parseInt(t.rating)-parseInt(i.rating)});for(var a in o)0==o[a].rating&&(o[a].rating="?");n=t(o);var r="";for(var a in n){void 0==n[a].link&&(n[a].link=""),void 0==n[a].icon&&(n[a].icon=""),void 0==n[a].a&&(n[a].a="");var e="<li id='"+a+"'>"+n[a].title+n[a].link+"<div class='pull-right'>"+n[a].rating+" % "+n[a].icon+"</div>"+n[a].a+"</li>";r+=e}i("#list").html(r);var l=JSON.stringify(n);localStorage.setItem("booklist",l)})}(jQuery);